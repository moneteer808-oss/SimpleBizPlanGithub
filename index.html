<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Interactive Business Plan Generator</title>
<style>
  header {
  position: sticky; 
  top: 0; 
  background: #1a1a1a; 
  color: white;
  padding: 12px 20px; 
  display: flex; 
  justify-content: space-between;
  align-items: center; 
  z-index: 1000;
}
header h1 { margin: 0; font-size: 18px; }
header button { margin-left: 10px; }
main { padding: 20px; max-width: 1000px; margin: auto; }
button {
  padding: 8px 14px; 
  background: #007bff; 
  color: white; 
  border: none;
  border-radius: 5px; 
  cursor: pointer;
}
button:hover { background: #0056b3; }
canvas, table { max-width: 100%; }
@media (max-width: 600px) {
  header h1 { font-size: 16px; }
  button { padding: 6px 10px; font-size: 14px; }
}
:root{--bg:#f9fafb;--card:#fff;--muted:#6b7280;--accent:#1e293b;}
body{font-family:Arial, sans-serif;background:var(--bg);margin:0;color:#111;padding:20px;}
.wrap{max-width:1100px;margin:0 auto;}
h1{margin:0 0 6px;color:var(--accent);}
p.lead{margin:0 0 18px;color:var(--muted);}
.card{background:var(--card);padding:16px;border-radius:10px;border:1px solid #e5e7eb;margin-bottom:16px;}
label{font-weight:600;margin-top:10px;display:block;}
input,textarea,select{width:100%;padding:8px;border:1px solid #d1d5db;border-radius:6px;margin-top:6px;box-sizing:border-box;}
textarea{min-height:60px;}
.button{background:var(--accent);color:#fff;padding:10px 14px;border:0;border-radius:8px;cursor:pointer;}
.button.secondary{background:#e5e7eb;color:#111;}
.plan{background:#fff;padding:18px;border-radius:8px;border:1px solid #e5e7eb;margin-top:18px;}
table{width:100%;border-collapse:collapse;margin-top:8px;}
th,td{border:1px solid #e5e7eb;padding:8px;text-align:left;}
th{background:#f3f4f6;}
.placeholder-grey{color:#6b7280;font-style:italic;}
.section-title{border-bottom:1px solid #e5e7eb;padding-bottom:6px;margin-bottom:10px;}
.edit-hint{font-size:12px;color:#6b7280;margin:0 0 10px;}
.charts-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;}
canvas{width:100%!important;height:260px!important;}
.ratio-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin:12px 0;}
.ratio-card{background:#f8fafc;padding:12px;border-radius:8px;text-align:center;box-shadow:0 1px 2px rgba(0,0,0,0.05);}
.ratio-card h3{margin:6px 0;font-size:22px;color:#111;}
.ratio-card p{margin:0;font-size:13px;color:#374151;}
.muted{color:var(--muted);font-size:13px;}
[contenteditable="true"]{outline:1px dashed #d1d5db;padding:6px;border-radius:4px;}
.business-header{background:#f8fafc;padding:16px;border-radius:8px;margin-bottom:20px;border:1px solid #e5e7eb;}
.business-info{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:10px;}
.info-item{text-align:center;}
.info-label{font-weight:600;color:var(--muted);font-size:12px;text-transform:uppercase;}
.info-value{font-size:16px;margin-top:4px;color:var(--accent);}
.assumptions-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:16px 0;}
.assumption-group{background:#f8fafc;padding:14px;border-radius:6px;}
.assumption-group h4{margin:0 0 10px;color:var(--accent);font-size:14px;}
.key-metrics-table{background:#f8fafc;padding:16px;border-radius:8px;margin:16px 0;}
body.printing .card,
body.printing #pageTitle,
body.printing .button {
  display: none !important;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<script>
const _p = [83, 105, 109, 112, 108, 101, 84, 101, 115, 116, 50, 50, 49, 49, 63]; // "SimpleTest2211?"
const correctPassword = _p.map(c => String.fromCharCode(c)).join('');

(function() {
  const savedAuth = localStorage.getItem('simplePlanAuth');
  if (savedAuth === correctPassword) return;

  const userInput = prompt("üîí This is a private demo. Email moneteer808@gmail.com with subject 'SimpleBizPlan Access' to get the password!");
  if (userInput === correctPassword) {
    localStorage.setItem('simplePlanAuth', correctPassword);
    location.reload();
  } else {
    document.body.innerHTML = `
      <div style="max-width:600px;margin:100px auto;text-align:center;font-family:Arial,sans-serif;padding:20px;">
        <h2 style="color:#dc2626;">‚ùå Access Denied</h2>
        <p>Email <a href="mailto:moneteer808@gmail.com">moneteer808@gmail.com</a> to request access.</p>
        <button onclick="location.reload()" style="margin-top:20px;padding:10px 20px;background:#1e293b;color:white;border:none;border-radius:6px;cursor:pointer;">
          Try Again
        </button>
      </div>
    `;
    throw new Error("Access denied");
  }
})();
</script>

<div class="wrap">
  <h1 id="pageTitle">Interactive Business Plan Generator</h1>
  <p class="lead">Fill in details below and click <strong>Generate Plan</strong> to create your business plan.</p>
  
  <div class="card">
    <p><strong>Note:</strong> Adjust financial inputs here. All financial tables and charts will update automatically when you regenerate the plan.</p>
    
    <label>Business Name</label>
    <input id="company" value="Your Company Name">
    
    <label>Owner</label>
    <input id="owner" value="Owner Name">
    
    <label>Location</label>
    <input id="location" value="Your City">
    
    <label>Industry</label>
    <input id="industry" value="Coffee Shop / Caf√©">
    
    <label>Daily Customers</label>
    <input id="dailyCustomers" type="number" value="80">
    
    <label>Average Spend per Customer</label>
    <input id="avgSpend" type="number" value="12">
    
    <label>Total Monthly Expenses</label>
    <input id="fixedExpenses" type="number" value="22000">
    
    <label>COGS %</label>
    <input id="cogsPct" type="number" value="30">
    
    <label>Startup Capital</label>
    <input id="startupCapital" type="number" value="48000">
    
    <label>Currency</label>
    <select id="currency">
      <option value="USD">USD ($) - US Dollar</option>
      <option value="EUR">EUR (‚Ç¨) - Euro</option>
      <option value="GBP">GBP (¬£) - British Pound</option>
      <option value="JPY">JPY (¬•) - Japanese Yen</option>
      <option value="CAD">CAD (C$) - Canadian Dollar</option>
      <option value="AUD">AUD (A$) - Australian Dollar</option>
      <option value="CHF">CHF (Fr) - Swiss Franc</option>
      <option value="CNY">CNY (¬•) - Chinese Yuan</option>
      <option value="INR">INR (‚Çπ) - Indian Rupee</option>
      <option value="IDR">IDR (Rp) - Indonesian Rupiah</option>
      <option value="SGD">SGD (S$) - Singapore Dollar</option>
      <option value="MYR">MYR (RM) - Malaysian Ringgit</option>
      <option value="THB">THB (‡∏ø) - Thai Baht</option>
      <option value="PHP">PHP (‚Ç±) - Philippine Peso</option>
      <option value="VND">VND (‚Ç´) - Vietnamese Dong</option>
    </select>
    
  </div>
  
  <button class="button" onclick="generatePlan()">Generate Plan</button>
  <button class="button secondary" onclick="printPlan()">Print / Save PDF</button>
  
  <div id="output" class="plan" style="display:none"></div>
</div>

<script>
function fmt(n, currency = 'USD'){
  const currencySymbols = {
    'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'JPY': '¬•', 'CAD': 'C$', 'AUD': 'A$',
    'CHF': 'Fr', 'CNY': '¬•', 'INR': '‚Çπ', 'IDR': 'Rp', 'SGD': 'S$', 'MYR': 'RM',
    'THB': '‡∏ø', 'PHP': '‚Ç±', 'VND': '‚Ç´'
  };
  const symbol = currencySymbols[currency] || '$';
  const formatted = new Intl.NumberFormat('en-US').format(Math.round(n));
  return symbol + formatted;
}

function editableSection(title,id,sample){
  return '<h2 class="section-title">'+title+'</h2><div id="'+id+'" contenteditable="true">'+sample+'</div>';
}

function generatePlan(){
  try {
    const data={};
    data.company=document.getElementById('company').value||'Your Company Name';
    data.owner=document.getElementById('owner').value||'Owner Name';
    data.location=document.getElementById('location').value||'Your City';
    data.industry=document.getElementById('industry').value||'Business Industry';
    data.daily=Number(document.getElementById('dailyCustomers').value)||0;
    data.avg=Number(document.getElementById('avgSpend').value)||0;
    data.fixed=Number(document.getElementById('fixedExpenses').value)||0;
    data.cogsPct=Number(document.getElementById('cogsPct').value)||0;
    data.startup=Number(document.getElementById('startupCapital').value)||0;
    data.currency=document.getElementById('currency').value||'USD';

    // Base month calculations
    let rev=data.daily*data.avg*30;
    let cogs=rev*(data.cogsPct/100);
    let grossProfit=rev-cogs;
    let net=grossProfit-data.fixed;
    let totalExpenses=cogs+data.fixed; // Fixed the missing variable
    let grossMargin=(rev>0)?(grossProfit)/rev:0;
    let operatingMargin=(rev>0)?net/rev:0;
    let breakeven=(net>0)?Math.ceil(data.startup/net):'N/A';

    // 12 months with 10% growth quarterly
    let revs=[],exps=[],nets=[],cumNet=0,cumNetArr=[],months=[];
    let customers=data.daily;
    for(let m=1;m<=12;m++){
      if(m>1 && (m-1)%3===0) customers=Math.round(customers*1.1);
      let r=customers*data.avg*30;
      let c=r*(data.cogsPct/100);
      let totalExp=c+data.fixed;
      let n=r-totalExp;
      revs.push(r);exps.push(totalExp);nets.push(n);
      cumNet+=n;cumNetArr.push(cumNet);
      months.push('M'+m);
    }

    // Business header
    let out='<div class="business-header">';
    out+='<h1 style="margin:0;text-align:center;color:var(--accent);">'+data.company+' Business Plan</h1>';
    out+='<div class="business-info">';
    out+='<div class="info-item"><div class="info-label">Business Name</div><div class="info-value">'+data.company+'</div></div>';
    out+='<div class="info-item"><div class="info-label">Owner</div><div class="info-value">'+data.owner+'</div></div>';
    out+='<div class="info-item"><div class="info-label">Location</div><div class="info-value">'+data.location+'</div></div>';
    out+='<div class="info-item"><div class="info-label">Industry</div><div class="info-value">'+data.industry+'</div></div>';
    out+='</div></div>';

    // Key Assumptions
    out+='<div class="key-metrics-table">';
    out+='<h3 style="margin:0 0 16px;color:var(--accent);">Key Assumptions</h3>';
    out+='<div class="assumptions-grid">';
    out+='<div class="assumption-group">';
    out+='<h3 style="margin:0 0 10px;color:var(--accent);">1. Customer Metrics</h3>';
    out+='<ul style="margin:0 0 16px 20px; padding-left: 16px; list-style-type: disc;">';
    out+='<li>Average Daily Customers: '+data.daily+'</li>';
    out+='<li>Average Spending per Customer: '+fmt(data.avg, data.currency)+'</li>';
    out+='</ul>';
    out+='</div>';
    out+='<div class="assumption-group">';
    out+='<h3 style="margin:0 0 10px;color:var(--accent);">2. Financial Parameters</h3>';
    out+='<ul style="margin:0 0 16px 20px; padding-left: 16px; list-style-type: disc;">';
    out+='<li>Total Monthly Expenses (excl. COGS): '+fmt(data.fixed, data.currency)+'</li>';
    out+='<li>COGS: '+data.cogsPct+'% of revenue</li>';
    out+='<li>Startup Capital: '+fmt(data.startup, data.currency)+'</li>';
    out+='</ul>';
    out+='</div>';
    out+='</div></div>';

    // Editable Sections
    out+=editableSection("1. Executive Summary","exec","This business plan outlines the vision for a "+data.industry.toLowerCase()+" business that aims to serve the local community with high-quality products and exceptional customer service. Our mission is to create a welcoming environment where customers can enjoy premium offerings while building lasting relationships.<br><br><span class='placeholder-grey'>[Add more details about mission, vision, unique value proposition, and key success factors...]</span>");
    
    out+=editableSection("2. Opportunity","opp","The "+data.industry.toLowerCase()+" market presents significant opportunities for growth, driven by increasing consumer demand for quality experiences and personalized service. Market research indicates strong potential in our target location with favorable demographics and limited direct competition.<br><br><span class='placeholder-grey'>[Add details about target market, market size, customer segments, and competitive landscape...]</span>");
    
    out+=editableSection("3. Execution","execPlan","Our execution strategy focuses on operational excellence, strategic marketing, and customer relationship management. We will implement a phased approach to market entry, starting with core offerings and expanding based on customer feedback and market response.<br><br><span class='placeholder-grey'>[Add details about marketing strategy, operational plan, key milestones, and implementation timeline...]</span>");
    
    out+=editableSection("4. Company","company","The company is founded and owned by dedicated professionals committed to delivering exceptional value to customers and stakeholders. Our team brings together diverse expertise in operations, customer service, and business management.<br><br><span class='placeholder-grey'>[Add details about company structure, team backgrounds, organizational chart, and key personnel...]</span>");

    // Financial Plan
    out+='<h2 class="section-title">5. Financial Plan</h2>';

    // Key Financial Ratios
    out+='<h3>5.1 Key Financial Ratios</h3>';
    out+='<table>';
    out+='<tr><th>Financial Metric</th><th>Formula</th><th>Current Value</th><th>Industry Benchmark</th></tr>';
    out+='<tr><td><strong>COGS</strong></td><td>Direct costs √∑ Revenue √ó 100</td><td>'+data.cogsPct+'%</td><td>30-70%</td></tr>';
    out+='<tr><td><strong>Gross Margin %</strong></td><td>(Revenue - COGS) √∑ Revenue √ó 100</td><td>'+(grossMargin*100).toFixed(1)+'%</td><td>20-80%</td></tr>';
    out+='<tr><td><strong>Operating Margin %</strong></td><td>Operating Income √∑ Revenue √ó 100</td><td>'+(operatingMargin*100).toFixed(1)+'%</td><td>5-25%</td></tr>';
    out+='<tr><td><strong>Break-Even (Months)</strong></td><td>Startup Capital √∑ Monthly Net Income</td><td>'+breakeven+'</td><td>6-24 months</td></tr>';
    out+='</table>';

    // Monthly Projection Breakdown
    out+='<h3>5.2 Monthly Financial Breakdown</h3>';
    out+='<table>';
    out+='<tr><th>Component</th><th>Calculation</th><th>Amount</th></tr>';
    out+='<tr><td>Monthly Revenue</td><td>'+data.daily+' customers √ó '+fmt(data.avg, data.currency)+' √ó 30 days</td><td>'+fmt(rev, data.currency)+'</td></tr>';
    out+='<tr><td>COGS ('+data.cogsPct+'%)</td><td>'+fmt(rev, data.currency)+' √ó '+data.cogsPct+'%</td><td>'+fmt(cogs, data.currency)+'</td></tr>';
    out+='<tr><td><strong>Gross Profit</strong></td><td>Revenue - COGS</td><td><strong>'+fmt(grossProfit, data.currency)+'</strong></td></tr>';
    out+='<tr><td>Total Monthly Expenses</td><td>Monthly operating costs</td><td>'+fmt(data.fixed, data.currency)+'</td></tr>';
    out+='<tr><td><strong>Total Expenses</strong></td><td>COGS + Total Monthly Expenses</td><td><strong>'+fmt(totalExpenses, data.currency)+'</strong></td></tr>';
    out+='<tr><td><strong>Net Profit</strong></td><td>Revenue - Total Expenses</td><td><strong>'+fmt(net, data.currency)+'</strong></td></tr>';
    out+='</table>';

    // 12-Month P&L
    out+='<h3>5.3 12-Month Profit & Loss Projection</h3>';
    out+='<table><tr><th>Month</th><th>Revenue</th><th>Total Expenses</th><th>Net Profit</th><th>Cumulative Profit</th></tr>';
    for(let i=0;i<12;i++){out+='<tr><td>'+months[i]+'</td><td>'+fmt(revs[i], data.currency)+'</td><td>'+fmt(exps[i], data.currency)+'</td><td>'+fmt(nets[i], data.currency)+'</td><td>'+fmt(cumNetArr[i], data.currency)+'</td></tr>';}
    out+='</table>';

    // Visual Charts
    out+='<div class="charts-row"><div><canvas id="chartRevExp"></canvas></div><div><canvas id="chartProfit"></canvas></div></div>';

    // Financial Health Snapshot
    out+='<h3>5.4 Financial Health Snapshot</h3>';
    out+='<div class="ratio-cards">';
    out+='<div class="ratio-card"><h3>'+fmt(rev, data.currency)+'</h3><p>Monthly Revenue</p></div>';
    out+='<div class="ratio-card"><h3>'+(grossMargin*100).toFixed(1)+'%</h3><p>Gross Margin</p></div>';
    out+='<div class="ratio-card"><h3>'+(operatingMargin*100).toFixed(1)+'%</h3><p>Operating Margin</p></div>';
    out+='<div class="ratio-card"><h3>'+breakeven+'</h3><p>Break-even (months)</p></div>';
    out+='</div>';

    // Break-even Analysis
    out+='<h3>5.5 Break-even Analysis</h3>';
    out+='<p>Based on current projections, the business will break even in approximately <strong>'+breakeven+' months</strong>, assuming consistent performance and the stated growth assumptions (10% customer growth quarterly).</p>';
    out+='<canvas id="chartBEP"></canvas>';

    // Risk Analysis
    out+='<h3>5.6 Financial Risk Analysis</h3>';
    out+='<ul>';
    out+='<li><strong>Revenue Risk:</strong> Customer acquisition may be slower than projected</li>';
    out+='<li><strong>Cost Risk:</strong> Fixed expenses or COGS may increase due to inflation</li>';
    out+='<li><strong>Competition Risk:</strong> New competitors may impact market share</li>';
    out+='<li><strong>Seasonal Risk:</strong> Revenue may fluctuate based on seasonal patterns</li>';
    out+='<li><strong>Cash Flow Risk:</strong> Need to monitor working capital requirements</li>';
    out+='</ul>';

    // Disclaimer
    out+='<p class="muted">‚ö†Ô∏è <strong>Disclaimer:</strong> These financial projections are estimates based on stated assumptions and industry benchmarks. Actual results may vary significantly depending on market conditions, execution quality, and external factors. Regular monitoring and adjustment of assumptions is recommended.</p>';
    out += `
      <hr style="border: 1px solid #ddd; margin: 40px 0;">
      <div style="text-align: center; font-size: 0.9em; color: #666; padding: 20px 0;">
        <p>Generated with <strong>SimpleBizPlan Generator</strong> by <a href="https://whop.com/moneteer/" target="_blank">Moneteer</a></p>
        <p>Connect: <a href="mailto:moneteer808@gmail.com">moneteer808@gmail.com</a></p>
      </div>
      `;
    document.getElementById('output').innerHTML=out;
    document.getElementById('output').style.display='block';
    document.getElementById('pageTitle').innerText=data.company+' ‚Äî Business Plan Generator';

    // Charts with detailed error handling
    console.log('Starting chart generation');
    setTimeout(function() {
      try {
        const ctxR=document.getElementById('chartRevExp');
        if(ctxR) {
          if(window._revExp) window._revExp.destroy();
          window._revExp=new Chart(ctxR,{
            type:'bar',
            data:{
              labels:months,
              datasets:[
                {label:'Revenue',data:revs,backgroundColor:'#2563eb'},
                {label:'Total Expenses',data:exps,backgroundColor:'#f97316'}
              ]
            },
            options:{
              responsive:true,
              plugins:{
                title:{display:true,text:'Monthly Revenue vs Expenses'}
              }
            }
          });
        }
        
        const ctxP=document.getElementById('chartProfit');
        if(ctxP) {
          if(window._profit) window._profit.destroy();
          window._profit=new Chart(ctxP,{
            data:{
              labels:months,
              datasets:[
                {type:'bar',label:'Net Profit',data:nets,backgroundColor:'#16a34a'},
                {type:'line',label:'Cumulative Net',data:cumNetArr,borderColor:'#0ea5e9',fill:false}
              ]
            },
            options:{
              responsive:true,
              plugins:{
                title:{display:true,text:'Profitability Trend'}
              }
            }
          });
        }
        
        const ctxB=document.getElementById('chartBEP');
        if(ctxB) {
          if(window._bep) window._bep.destroy();
          let cumulativeRevs = [];
          let cumSum = 0;
          for(let i = 0; i < revs.length; i++) {
            cumSum += revs[i];
            cumulativeRevs.push(cumSum);
          }
          
          window._bep=new Chart(ctxB,{
            data:{
              labels:months,
              datasets:[
                {type:'bar',label:'Cumulative Revenue',data:cumulativeRevs,backgroundColor:'#3b82f6'},
                {type:'line',label:'Break-even Threshold',data:months.map(()=>data.startup),borderColor:'#ef4444',fill:false,pointRadius:0}
              ]
            },
            options:{
              responsive:true,
              plugins:{
                title:{display:true,text:'Break-even Analysis'}
              }
            }
          });
        }
        console.log('Charts created successfully');
      } catch(chartError) {
        console.error('Chart creation error:', chartError);
      }
    }, 100);
    
  } catch(error) {
    console.error('Function error:', error);
    alert('Error generating plan: ' + error.message);
  }
}

function printPlan() {
  // Detect mobile
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

  if (isMobile) {
    saveAsPDF();
  } else {
    printAsPDF();
  }
}

function saveAsPDF() {
  const { jsPDF } = window.jspdf;

  const element = document.getElementById('output');
  if (!element) {
    alert("Please generate plan first.");
    return;
  }

  // Temporarily override styles for PDF capture
  const tempStyle = document.createElement('style');
  tempStyle.innerHTML = `
    #output {
      width: 210mm !important; /* A4 width */
      min-height: 297mm !important;
      padding: 15px !important;
      font-size: 10.5pt !important;
      transform: scale(1) !important;
      transform-origin: top left !important;
    }
    table {
      font-size: 9.5pt !important;
      width: 100% !important;
    }
    canvas {
      max-height: 180px !important;
      width: 100% !important;
    }
    .charts-row {
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 12px !important;
    }
    @media print {
      body { -webkit-print-color-adjust: exact; }
    }
  `;
  document.head.appendChild(tempStyle);

  // Capture with optimized settings
  html2canvas(element, {
    scale: 1.2,           // Balanced quality/size (was 2)
    useCORS: true,
    logging: false,
    width: 1240,          // Desktop width (~A4 at 96dpi)
    windowWidth: 1240,
    windowHeight: 1754,   // A4 height at 96dpi
    scrollY: -window.scrollY
  }).then(canvas => {
    const imgData = canvas.toDataURL('image/jpeg', 0.7); // JPEG + 70% quality
    const pdf = new jsPDF('p', 'mm', 'a4');
    const imgWidth = 210; // A4 width in mm
    const pageHeight = 297;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    let heightLeft = imgHeight;
    let position = 0;

    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;

    while (heightLeft > 0) {
      position = heightLeft - imgHeight;
      pdf.addPage();
      pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;
    }

    // Filename
    const companyName = document.getElementById('company').value || 'Business';
    const today = new Date().toISOString().split('T')[0];
    pdf.save(`${companyName} Business Plan - ${today}.pdf`);

    // Clean up
    document.head.removeChild(tempStyle);

  }).catch(error => {
    console.error("PDF generation error:", error);
    alert("Error generating PDF. Please try desktop or contact support.");
  });
}

function printAsPDF() {
  try {
    const companyName = document.getElementById('company').value || 'Business';

    // Convert charts to images
    const chartContainers = ['.charts-row'];
    const tempImages = [];

    chartContainers.forEach(selector => {
      const container = document.querySelector(selector);
      if (!container) return;

      const canvases = container.querySelectorAll('canvas');
      canvases.forEach(canvas => {
        if (!canvas.chart) return;

        const img = document.createElement('img');
        img.src = canvas.chart.toBase64Image();
        img.style.cssText = 'width: 100%; max-height: 220px; margin: 10px 0; display: block;';

        canvas.parentNode.insertBefore(img, canvas.nextSibling);
        tempImages.push(img);
        canvas.style.display = 'none';
      });
    });

    // Print styles
    const style = document.createElement('style');
    style.innerHTML = `
      @media print {
        body { font-size: 10.5pt; line-height: 1.4; }
        .card, #pageTitle, .button, .edit-hint { display: none !important; }
        .wrap { max-width: 100%; padding: 0; margin: 0; }
        .plan { padding: 15px; }
        table { font-size: 9.5pt; width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 5px 6px; border: 1px solid #000; vertical-align: top; }
        h1 { font-size: 15pt; margin-bottom: 8px; }
        h2 { font-size: 13pt; margin-top: 20px; margin-bottom: 6px; }
        .section-title:nth-of-type(5) { break-before: always; }
        .generated-by { margin-top: 30px; font-size: 9pt; text-align: center; }
      }
      @page { margin: 0.5in; }
    `;
    document.head.appendChild(style);

    // Add timestamp
    const signature = document.querySelector('.generated-by');
    if (signature && signature.parentNode) {
      const timestamp = document.createElement('div');
      timestamp.style.cssText = 'text-align: center; font-size: 8.5pt; color: #666; margin: 15px 0 5px;';
      timestamp.textContent = `Printed on ${new Date().toLocaleString()} ‚Äî Generated with SimpleBizPlan Generator`;
      signature.parentNode.insertBefore(timestamp, signature);
    }

    window.print();

    // Clean up
    setTimeout(() => {
      document.querySelectorAll('canvas').forEach(c => c.style.display = '');
      tempImages.forEach(img => img.parentNode && img.parentNode.removeChild(img));
      style.parentNode && style.parentNode.removeChild(style);
      const ts = document.querySelector('div[style*="Printed on"]');
      ts && ts.parentNode && ts.parentNode.removeChild(ts);
    }, 1000);

  } catch (error) {
    console.error("Print error:", error);
    alert("Error generating print output.");
  }
}
</script>
</body>
</html>